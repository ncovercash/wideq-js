"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const _ = __importStar(require("lodash"));
var ValueType;
(function (ValueType) {
    ValueType["Bit"] = "Bit";
    ValueType["Enum"] = "Enum";
    ValueType["Range"] = "Range";
    ValueType["Reference"] = "Reference";
    ValueType["StringComment"] = "StringComment";
})(ValueType = exports.ValueType || (exports.ValueType = {}));
class ModelInfo {
    constructor(data) {
        this.data = data;
    }
    value(name) {
        const data = this.data.Value[name];
        if (data === undefined) {
            return null;
        }
        switch (data.type.toLowerCase()) {
            case 'enum':
                return {
                    type: ValueType.Enum,
                    options: data.option,
                };
            case 'range':
                return {
                    type: ValueType.Range,
                    min: data.option.min,
                    max: data.option.max,
                    step: _.get(data.option, 'step', 1),
                };
            case 'bit': {
                const bitValues = Object.values(data.option).reduce((obj, value) => (Object.assign({}, obj, { [value.startbit]: value.values })), {});
                return { type: ValueType.Bit, options: bitValues };
            }
            case 'reference': {
                const [ref] = data.option;
                return { type: ValueType.Reference, reference: this.data[ref] };
            }
            case 'string':
                if (typeof data._comment === 'string') {
                    return { type: ValueType.StringComment, comment: data._comment };
                }
                return null;
            default:
                throw new Error(`Unsupported value type: ${data.type}`);
        }
    }
    default(name) {
        return this.data.Value[name].default;
    }
    enumValue(key, name) {
        const options = this.value(key).options;
        // invert them pa
        const optionsInv = _.invert(options);
        return optionsInv[name];
    }
    enumName(key, value) {
        const options = this.value(key).options;
        if (!(value in options)) {
            return null;
        }
        return options[value];
    }
    referenceName(key, value) {
        const val = String(value);
        const reference = this.value(key).reference;
        if (value in reference) {
            return reference[value]._comment;
        }
        return null;
    }
    get binaryMonitorData() {
        return this.data.Monitoring.type === 'BINARY(BYTE)';
    }
    decodeMonitor(data) {
        return this.binaryMonitorData ? this.decodeMonitorBinary(data) : this.decodeMonitorJson(data);
    }
    decodeMonitorBinary(data) {
        const decoded = {};
        for (const item of this.data.Monitoring.protocol) {
            const key = item.value;
            let value = 0;
            for (let i = item.startByte; i < item.startByte + item.length; i++) {
                const v = data[i];
                value = (value << 8) + v;
                decoded[key] = String(value);
            }
        }
        return decoded;
    }
    decodeMonitorJson(data) {
        return JSON.parse(data.toString('utf-8'));
    }
}
exports.ModelInfo = ModelInfo;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwtaW5mby5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9jb3JlL21vZGVsLWluZm8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsMENBQTRCO0FBRTVCLElBQVksU0FNWDtBQU5ELFdBQVksU0FBUztJQUNuQix3QkFBVyxDQUFBO0lBQ1gsMEJBQWEsQ0FBQTtJQUNiLDRCQUFlLENBQUE7SUFDZixvQ0FBdUIsQ0FBQTtJQUN2Qiw0Q0FBK0IsQ0FBQTtBQUNqQyxDQUFDLEVBTlcsU0FBUyxHQUFULGlCQUFTLEtBQVQsaUJBQVMsUUFNcEI7QUFxREQsTUFBYSxTQUFTO0lBQ3BCLFlBQ1MsSUFBZTtRQUFmLFNBQUksR0FBSixJQUFJLENBQVc7SUFFeEIsQ0FBQztJQUVNLEtBQUssQ0FBQyxJQUFZO1FBQ3ZCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25DLElBQUksSUFBSSxLQUFLLFNBQVMsRUFBRTtZQUN0QixPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFFO1lBQy9CLEtBQUssTUFBTTtnQkFDVCxPQUFPO29CQUNMLElBQUksRUFBRSxTQUFTLENBQUMsSUFBSTtvQkFDcEIsT0FBTyxFQUFFLElBQUksQ0FBQyxNQUFNO2lCQUNSLENBQUM7WUFFakIsS0FBSyxPQUFPO2dCQUNWLE9BQU87b0JBQ0wsSUFBSSxFQUFFLFNBQVMsQ0FBQyxLQUFLO29CQUNyQixHQUFHLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHO29CQUNwQixHQUFHLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHO29CQUNwQixJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7aUJBQ3RCLENBQUM7WUFFbEIsS0FB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RUFBRSxDQUFDO1FBRTNDLEtBQUssTUFBTSxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFO1lBQ2hELE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDdkIsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO1lBRWQsS0FBSyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQ2xFLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbEIsS0FBSyxHQUFHLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDekIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUM5QjtTQUNGO1FBRUQsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQztJQUVPLGlCQUFpQixDQUFDLElBQVM7UUFDakMsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUM1QyxDQUFDO0NBRUY7QUFoSEQsOEJBZ0hDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuXG5leHBvcnQgZW51bSBWYWx1ZVR5cGUge1xuICBCaXQgPSAnQml0JyxcbiAgRW51bSA9ICdFbnVtJyxcbiAgUmFuZ2UgPSAnUmFuZ2UnLFxuICBSZWZlcmVuY2UgPSAnUmVmZXJlbmNlJyxcbiAgU3RyaW5nQ29tbWVudCA9ICdTdHJpbmdDb21tZW50Jyxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNb2RlbERhdGFWYWx1ZSB7XG4gIHR5cGU6IHN0cmluZztcblxuICBba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTW9kZWxEYXRhIHtcbiAgSW5mbzoge1xuICAgIHByb2R1Y3RUeXBlOiBzdHJpbmc7XG4gICAgcHJvZHVjdENvZGU6IHN0cmluZztcbiAgICBjb3V0bnJ5OiBzdHJpbmc7XG4gICAgbW9kZWxUeXBlOiBzdHJpbmc7XG4gICAgbW9kZWw6IHN0cmluZztcbiAgICBtb2RlbE5hbWU6IHN0cmluZztcbiAgICBuZXR3b3JrVHlwZTogc3RyaW5nO1xuICAgIHZlcnNpb246IHN0cmluZztcbiAgfTtcbiAgVmFsdWU6IHtcbiAgICBba2V5OiBzdHJpbmddOiBNb2RlbERhdGFWYWx1ZTtcbiAgfTtcblxuICBba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQml0VmFsdWUge1xuICB0eXBlOiBWYWx1ZVR5cGUuQml0O1xuICBvcHRpb25zOiBhbnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRW51bVZhbHVlIHtcbiAgdHlwZTogVmFsdWVUeXBlLkVudW07XG4gIG9wdGlvbnM6IGFueTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSYW5nZVZhbHVlIHtcbiAgdHlwZTogVmFsdWVUeXBlLlJhbmdlO1xuICBtaW46IG51bWJlcjtcbiAgbWF4OiBudW1iZXI7XG4gIHN0ZXA6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZWZlcmVuY2VWYWx1ZSB7XG4gIHR5cGU6IFZhbHVlVHlwZS5SZWZlcmVuY2U7XG4gIHJlZmVyZW5jZTogYW55O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0cmluZ0NvbW1lbnRWYWx1ZSB7XG4gIHR5cGU6IFZhbHVlVHlwZS5TdHJpbmdDb21tZW50O1xuICBjb21tZW50OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBNb2RlbEluZm8ge1xuICBwdWJsaWMgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGRhdGE6IE1vZGVsRGF0YSxcbiAgKSB7XG4gIH1cblxuICBwdWJsaWMgdmFsdWUobmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YS5WYWx1ZVtuYW1lXTtcbiAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKGRhdGEudHlwZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICBjYXNlICdlbnVtJzpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0eXBlOiBWYWx1ZVR5cGUuRW51bSxcbiAgICAgICAgICBvcHRpb25zOiBkYXRhLm9wdGlvbixcbiAgICAgICAgfSBhcyBFbnVtVmFsdWU7XG5cbiAgICAgIGNhc2UgJ3JhbmdlJzpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0eXBlOiBWYWx1ZVR5cGUuUmFuZ2UsXG4gICAgICAgICAgbWluOiBkYXRhLm9wdGlvbi5taW4sXG4gICAgICAgICAgbWF4OiBkYXRhLm9wdGlvbi5tYXgsXG4gICAgICAgICAgc3RlcDogXy5nZXQoZGF0YS5vcHRpb24sICdzdGVwJywgMSksXG4gICAgICAgIH0gYXMgUmFuZ2VWYWx1ZTtcblxuICAgICAgY2FzZSAnYml0Jzoge1xuICAgICAgICBjb25zdCBiaXRWYWx1ZXMgPSBPYmplY3QudmFsdWVzKGRhdGEub3B0aW9uKS5yZWR1Y2UoKG9iaiwgdmFsdWUpID0+ICh7XG4gICAgICAgICAgLi4ub2JqLFxuICAgICAgICAgIFsodmFsdWUgYXMgYW55KS5zdGFydGJpdF06ICh2YWx1ZSBhcyBhbnkpLnZhbHVlcyxcbiAgICAgICAgfSksIHt9KTtcbiAgICAgICAgcmV0dXJuIHsgdHlwZTogVmFsdWVUeXBlLkJpdCwgb3B0aW9uczogYml0VmFsdWVzIH0gYXMgQml0VmFsdWU7XG4gICAgICB9XG5cbiAgICAgIGNhc2UgJ3JlZmVyZW5jZSc6IHtcbiAgICAgICAgY29uc3QgW3JlZl0gPSBkYXRhLm9wdGlvbjtcbiAgICAgICAgcmV0dXJuIHsgdHlwZTogVmFsdWVUeXBlLlJlZmVyZW5jZSwgcmVmZXJlbmNlOiB0aGlzLmRhdGFbcmVmXSB9IGFzIFJlZmVyZW5jZVZhbHVlO1xuICAgICAgfVxuXG4gICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICBpZiAodHlwZW9mIGRhdGEuX2NvbW1lbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuIHsgdHlwZTogVmFsdWVUeXBlLlN0cmluZ0NvbW1lbnQsIGNvbW1lbnQ6IGRhdGEuX2NvbW1lbnQgfSBhcyBTdHJpbmdDb21tZW50VmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgdmFsdWUgdHlwZTogJHtkYXRhLnR5cGV9YCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGRlZmF1bHQobmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YS5WYWx1ZVtuYW1lXS5kZWZhdWx0O1xuICB9XG5cbiAgcHVibGljIGVudW1WYWx1ZShrZXk6IHN0cmluZywgbmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9ICh0aGlzLnZhbHVlKGtleSkgYXMgRW51bVZhbHVlKS5vcHRpb25zO1xuICAgIC8vIGludmVydCB0aGVtIHBhXG4gICAgY29uc3Qgb3B0aW9uc0ludiA9IF8uaW52ZXJ0KG9wdGlvbnMpO1xuXG4gICAgcmV0dXJuIG9wdGlvbnNJbnZbbmFtZV07XG4gIH1cblxuICBwdWJsaWMgZW51bU5hbWUoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcbiAgICBjb25zdCBvcHRpb25zID0gKHRoaXMudmFsdWUoa2V5KSBhcyBFbnVtVmFsdWUpLm9wdGlvbnM7XG4gICAgaWYgKCEodmFsdWUgaW4gb3B0aW9ucykpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBvcHRpb25zW3ZhbHVlXTtcbiAgfVxuXG4gIHB1YmxpYyByZWZlcmVuY2VOYW1lKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KTogc3RyaW5nIHwgbnVsbCB7XG4gICAgY29uc3QgdmFsID0gU3RyaW5nKHZhbHVlKTtcbiAgICBjb25zdCByZWZlcmVuY2UgPSAodGhpcy52YWx1ZShrZXkpIGFzIFJlZmVyZW5jZVZhbHVlKS5yZWZlcmVuY2U7XG5cbiAgICBpZiAodmFsdWUgaW4gcmVmZXJlbmNlKSB7XG4gICAgICByZXR1cm4gcmVmZXJlbmNlW3ZhbHVlXS5fY29tbWVudDtcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgYmluYXJ5TW9uaXRvckRhdGEoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YS5Nb25pdG9yaW5nLnR5cGUgPT09ICdCSU5BUlkoQllURSknO1xuICB9XG5cbiAgcHVibGljIGRlY29kZU1vbml0b3IoZGF0YTogYW55KSB7XG4gICAgcmV0dXJuIHRoaXMuYmluYXJ5TW9uaXRvckRhdGEgPyB0aGlzLmRlY29kZU1vbml0b3JCaW5hcnkoZGF0YSkgOiB0aGlzLmRlY29kZU1vbml0b3JKc29uKGRhdGEpO1xuICB9XG5cbiAgcHJpdmF0ZSBkZWNvZGVNb25pdG9yQmluYXJ5KGRhdGE6IGFueSkge1xuICAgIGNvbnN0IGRlY29kZWQ6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcblxuICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLmRhdGEuTW9uaXRvcmluZy5wcm90b2NvbCkge1xuICAgICAgY29uc3Qga2V5ID0gaXRlbS52YWx1ZTtcbiAgICAgIGxldCB2YWx1ZSA9IDA7XG5cbiAgICAgIGZvciAobGV0IGkgPSBpdGVtLnN0YXJ0Qnl0ZTsgaSA8IGl0ZW0uc3RhcnRCeXRlICsgaXRlbS5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCB2ID0gZGF0YVtpXTtcbiAgICAgICAgdmFsdWUgPSAodmFsdWUgPDwgOCkgKyB2O1xuICAgICAgICBkZWNvZGVkW2tleV0gPSBTdHJpbmcodmFsdWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBkZWNvZGVkO1xuICB9XG5cbiAgcHJpdmF0ZSBkZWNvZGVNb25pdG9ySnNvbihkYXRhOiBhbnkpIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhLnRvU3RyaW5nKCd1dGYtOCcpKTtcbiAgfVxuXG59XG4iXX0=